!function(e){var t={};function a(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(s,i,function(t){return e[t]}.bind(null,i));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=7)}([function(e,t,a){"use strict";var s,i={},r=function(){return void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s},n=function(){var e={};return function(t){if(void 0===e[t]){var a=document.querySelector(t);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}e[t]=a}return e[t]}}();function c(e,t){for(var a=[],s={},i=0;i<e.length;i++){var r=e[i],n=t.base?r[0]+t.base:r[0],c={css:r[1],media:r[2],sourceMap:r[3]};s[n]?s[n].parts.push(c):a.push(s[n]={id:n,parts:[c]})}return a}function o(e,t){for(var a=0;a<e.length;a++){var s=e[a],r=i[s.id],n=0;if(r){for(r.refs++;n<r.parts.length;n++)r.parts[n](s.parts[n]);for(;n<s.parts.length;n++)r.parts.push(f(s.parts[n],t))}else{for(var c=[];n<s.parts.length;n++)c.push(f(s.parts[n],t));i[s.id]={id:s.id,refs:1,parts:c}}}}function h(e){var t=document.createElement("style");if(void 0===e.attributes.nonce){var s=a.nc;s&&(e.attributes.nonce=s)}if(Object.keys(e.attributes).forEach((function(a){t.setAttribute(a,e.attributes[a])})),"function"==typeof e.insert)e.insert(t);else{var i=n(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var l,y=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function k(e,t,a,s){var i=a?"":s.css;if(e.styleSheet)e.styleSheet.cssText=y(t,i);else{var r=document.createTextNode(i),n=e.childNodes;n[t]&&e.removeChild(n[t]),n.length?e.insertBefore(r,n[t]):e.appendChild(r)}}function d(e,t,a){var s=a.css,i=a.media,r=a.sourceMap;if(i&&e.setAttribute("media",i),r&&btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}var p=null,v=0;function f(e,t){var a,s,i;if(t.singleton){var r=v++;a=p||(p=h(t)),s=k.bind(null,a,r,!1),i=k.bind(null,a,r,!0)}else a=h(t),s=d.bind(null,a,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(a)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).attributes="object"==typeof t.attributes?t.attributes:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=r());var a=c(e,t);return o(a,t),function(e){for(var s=[],r=0;r<a.length;r++){var n=a[r],h=i[n.id];h&&(h.refs--,s.push(h))}e&&o(c(e,t),t);for(var l=0;l<s.length;l++){var y=s[l];if(0===y.refs){for(var k=0;k<y.parts.length;k++)y.parts[k]();delete i[y.id]}}}}},function(e,t,a){var s=a(2);"string"==typeof s&&(s=[[e.i,s,""]]);var i={insert:"head",singleton:!1};a(0)(s,i);s.locals&&(e.exports=s.locals)},function(e,t,a){},function(e,t,a){var s=a(4);"string"==typeof s&&(s=[[e.i,s,""]]);var i={insert:"head",singleton:!1};a(0)(s,i);s.locals&&(e.exports=s.locals)},function(e,t,a){},function(e,t,a){var s=a(6);"string"==typeof s&&(s=[[e.i,s,""]]);var i={insert:"head",singleton:!1};a(0)(s,i);s.locals&&(e.exports=s.locals)},function(e,t,a){},function(e,t,a){"use strict";a.r(t);a(1),a(3),a(5);var s=[["key_tilda","key_1","key_2","key_3","key_4","key_5","key_6","key_7","key_8","key_9","key_0","key_minus","key_equal","key_backspace"],["key_tab","key_q","key_w","key_e","key_r","key_t","key_y","key_u","key_i","key_o","key_p","key_bracket_left","key_bracket_right","key_delete"],["key_capslock","key_a","key_s","key_d","key_f","key_g","key_h","key_j","key_k","key_l","key_doubledot","key_quote","key_enter"],["key_shift_left","key_backslash","key_z","key_x","key_c","key_v","key_b","key_n","key_m","key_comma","key_dot","key_slash","key_up","key_shift_right"],["key_ctrl_left","key_win_left","key_alt_left","key_space","key_alt_right","key_win_right","key_left","key_down","key_right","key_ctrl_right"]];const i={key_tilda:{isFn:!1,isLock:!1,eventKey:"Dead",eventCode:"Backquote",char:"`",charShift:"~",charCaps:"`"},key_1:{isFn:!1,isLock:!1,eventCode:"Digit1",char:"1",charShift:"!",charCaps:"1"},key_2:{isFn:!1,isLock:!1,eventCode:"Digit2",char:"2",charShift:"@",charCaps:"2"},key_3:{isFn:!1,isLock:!1,eventCode:"Digit3",char:"3",charShift:"#",charCaps:"3"},key_4:{isFn:!1,isLock:!1,eventCode:"Digit4",char:"4",charShift:"$",charCaps:"4"},key_5:{isFn:!1,isLock:!1,eventCode:"Digit5",char:"5",charShift:"%",charCaps:"5"},key_6:{isFn:!1,isLock:!1,eventCode:"Digit6",char:"6",charShift:"^",charCaps:"6"},key_7:{isFn:!1,isLock:!1,eventCode:"Digit7",char:"7",charShift:"&",charCaps:"7"},key_8:{isFn:!1,isLock:!1,eventCode:"Digit8",char:"8",charShift:"*",charCaps:"8"},key_9:{isFn:!1,isLock:!1,eventCode:"Digit9",char:"9",charShift:"(",charCaps:"9"},key_0:{isFn:!1,isLock:!1,eventCode:"Digit0",char:"0",charShift:")",charCaps:"0"},key_minus:{isFn:!1,isLock:!1,eventCode:"Minus",char:"-",charShift:"_",charCaps:"-"},key_equal:{isFn:!1,isLock:!1,eventCode:"Equal",char:"=",charShift:"+",charCaps:"="},key_backspace:{isFn:!0,isLock:!1,eventCode:"Backspace",eventType:"removePrev",char:"Backspace"},key_tab:{isFn:!0,isLock:!1,eventCode:"Tab",eventType:"insertTab",char:"TAB"},key_q:{isFn:!1,isLock:!1,eventCode:"KeyQ",char:"q",charShift:"Q",charCaps:"Q"},key_w:{isFn:!1,isLock:!1,eventCode:"KeyW",char:"w",charShift:"W",charCaps:"W"},key_e:{isFn:!1,isLock:!1,eventCode:"KeyE",char:"e",charShift:"E",charCaps:"E"},key_r:{isFn:!1,isLock:!1,eventCode:"KeyR",char:"r",charShift:"R",charCaps:"R"},key_t:{isFn:!1,isLock:!1,eventCode:"KeyT",char:"t",charShift:"T",charCaps:"T"},key_y:{isFn:!1,isLock:!1,eventCode:"KeyY",char:"y",charShift:"Y",charCaps:"Y"},key_u:{isFn:!1,isLock:!1,eventCode:"KeyU",char:"u",charShift:"U",charCaps:"U"},key_i:{isFn:!1,isLock:!1,eventCode:"KeyI",char:"i",charShift:"I",charCaps:"I"},key_o:{isFn:!1,isLock:!1,eventCode:"KeyO",char:"o",charShift:"O",charCaps:"O"},key_p:{isFn:!1,isLock:!1,eventCode:"KeyP",char:"p",charShift:"P",charCaps:"P"},key_bracket_left:{isFn:!1,isLock:!1,eventCode:"BracketLeft",char:"[",charShift:"{",charCaps:"["},key_bracket_right:{isFn:!1,isLock:!1,eventCode:"BracketRight",char:"]",charShift:"}",charCaps:"]"},key_delete:{isFn:!0,isLock:!1,eventCode:"Delete",eventType:"removeNext",char:"DEL"},key_capslock:{isFn:!0,isLock:!0,eventCode:"CapsLock",eventType:"toggleCaps",char:"CapsLock"},key_a:{isFn:!1,isLock:!1,eventCode:"KeyA",char:"a",charShift:"A",charCaps:"A"},key_s:{isFn:!1,isLock:!1,eventCode:"KeyS",char:"s",charShift:"S",charCaps:"S"},key_d:{isFn:!1,isLock:!1,eventCode:"KeyD",char:"d",charShift:"D",charCaps:"D"},key_f:{isFn:!1,isLock:!1,eventCode:"KeyF",char:"f",charShift:"F",charCaps:"F"},key_g:{isFn:!1,isLock:!1,eventCode:"KeyG",char:"g",charShift:"G",charCaps:"G"},key_h:{isFn:!1,isLock:!1,eventCode:"KeyH",char:"h",charShift:"H",charCaps:"H"},key_j:{isFn:!1,isLock:!1,eventCode:"KeyJ",char:"j",charShift:"J",charCaps:"J"},key_k:{isFn:!1,isLock:!1,eventCode:"KeyK",char:"k",charShift:"K",charCaps:"K"},key_l:{isFn:!1,isLock:!1,eventCode:"KeyL",char:"l",charShift:"L",charCaps:"L"},key_doubledot:{isFn:!1,isLock:!1,eventCode:"Semicolon",char:";",charShift:":",charCaps:";"},key_quote:{isFn:!1,isLock:!1,eventCode:"Quote",char:"'",charShift:'"',charCaps:"'"},key_enter:{isFn:!0,isLock:!1,eventCode:"Enter",eventType:"newLine",char:"Enter"},key_shift_left:{isFn:!0,isLock:!0,eventCode:"ShiftLeft",eventType:"toggleShift",char:"L. Shift",pairKey:"key_shift_right"},key_backslash:{isFn:!1,isLock:!1,eventCode:"Backslash",char:"\\",charShift:"|",charCaps:"\\"},key_z:{isFn:!1,isLock:!1,eventCode:"KeyZ",char:"z",charShift:"Z",charCaps:"Z"},key_x:{isFn:!1,isLock:!1,eventCode:"KeyX",char:"x",charShift:"X",charCaps:"X"},key_c:{isFn:!1,isLock:!1,eventCode:"KeyC",char:"c",charShift:"C",charCaps:"C"},key_v:{isFn:!1,isLock:!1,eventCode:"KeyV",char:"v",charShift:"V",charCaps:"V"},key_b:{isFn:!1,isLock:!1,eventCode:"KeyB",char:"b",charShift:"B",charCaps:"B"},key_n:{isFn:!1,isLock:!1,eventCode:"KeyN",char:"n",charShift:"N",charCaps:"N"},key_m:{isFn:!1,isLock:!1,eventCode:"KeyM",char:"m",charShift:"M",charCaps:"M"},key_comma:{isFn:!1,isLock:!1,eventCode:"Comma",char:",",charShift:"<",charCaps:","},key_dot:{isFn:!1,isLock:!1,eventCode:"Period",char:".",charShift:">",charCaps:"."},key_slash:{isFn:!1,isLock:!1,eventCode:"Slash",char:"/",charShift:"?",charCaps:"/"},key_up:{isFn:!0,isLock:!1,eventCode:"ArrowUp",eventType:"moveUp",char:"▲"},key_shift_right:{isFn:!0,isLock:!0,eventCode:"ShiftRight",eventType:"toggleShift",char:"R. Shift",pairKey:"key_shift_left"},key_ctrl_left:{isFn:!0,isLock:!0,eventCode:"ControlLeft",eventType:"toggleControl",char:"Ctrl",pairKey:"key_ctrl_right"},key_win_left:{isFn:!0,isLock:!1,eventCode:"MetaLeft ",eventType:"toggleWin",char:"WIN",pairKey:"key_win_right"},key_alt_left:{isFn:!0,isLock:!0,eventCode:"AltLeft",eventType:"toggleAlt",char:"Alt",pairKey:"key_alt_right"},key_space:{isFn:!1,isLock:!1,eventCode:"Space",char:" ",charShift:" ",charCaps:" "},key_alt_right:{isFn:!0,isLock:!0,eventCode:"AltRight",eventType:"toggleAlt",char:"Alt",pairKey:"key_alt_left"},key_win_right:{isFn:!0,isLock:!1,eventCode:"MetaRight ",eventType:"toggleWin",char:"WIN",pairKey:"key_win_left"},key_left:{isFn:!0,isLock:!1,eventCode:"ArrowLeft",eventType:"movePrev",char:"◄"},key_down:{isFn:!0,isLock:!1,eventCode:"ArrowDown",eventType:"moveDown",char:"▼"},key_right:{isFn:!0,isLock:!1,eventCode:"ArrowRight",eventType:"moveNext",char:"►"},key_ctrl_right:{isFn:!0,isLock:!0,eventCode:"ControlRight",eventType:"toggleControl",char:"Ctrl",pairKey:"key_ctrl_left"}},r={key_tilda:{isFn:!1,isLock:!1,eventKey:"Dead",eventCode:"Backquote",char:"ё",charShift:"Ё",charCaps:""},key_1:{isFn:!1,isLock:!1,eventCode:"Digit1",char:"1",charShift:"!",charCaps:"1"},key_2:{isFn:!1,isLock:!1,eventCode:"Digit2",char:"2",charShift:'"',charCaps:"2"},key_3:{isFn:!1,isLock:!1,eventCode:"Digit3",char:"3",charShift:"№",charCaps:"3"},key_4:{isFn:!1,isLock:!1,eventCode:"Digit4",char:"4",charShift:";",charCaps:"4"},key_5:{isFn:!1,isLock:!1,eventCode:"Digit5",char:"5",charShift:"%",charCaps:"5"},key_6:{isFn:!1,isLock:!1,eventCode:"Digit6",char:"6",charShift:":",charCaps:"6"},key_7:{isFn:!1,isLock:!1,eventCode:"Digit7",char:"7",charShift:"?",charCaps:"7"},key_8:{isFn:!1,isLock:!1,eventCode:"Digit8",char:"8",charShift:"*",charCaps:"8"},key_9:{isFn:!1,isLock:!1,eventCode:"Digit9",char:"9",charShift:"(",charCaps:"9"},key_0:{isFn:!1,isLock:!1,eventCode:"Digit0",char:"0",charShift:")",charCaps:"0"},key_minus:{isFn:!1,isLock:!1,eventCode:"Minus",char:"-",charShift:"_",charCaps:"-"},key_equal:{isFn:!1,isLock:!1,eventCode:"Equal",char:"=",charShift:"+",charCaps:"="},key_backspace:{isFn:!0,isLock:!1,eventCode:"Backspace",eventType:"removePrev",char:"Backspace"},key_tab:{isFn:!0,isLock:!1,eventCode:"Tab",eventType:"insertTab",char:"TAB"},key_q:{isFn:!1,isLock:!1,eventCode:"KeyQ",char:"й",charShift:"Й",charCaps:"Й"},key_w:{isFn:!1,isLock:!1,eventCode:"KeyW",char:"ц",charShift:"Ц",charCaps:"Ц"},key_e:{isFn:!1,isLock:!1,eventCode:"KeyE",char:"у",charShift:"У",charCaps:"У"},key_r:{isFn:!1,isLock:!1,eventCode:"KeyR",char:"к",charShift:"К",charCaps:"К"},key_t:{isFn:!1,isLock:!1,eventCode:"KeyT",char:"е",charShift:"Е",charCaps:"Е"},key_y:{isFn:!1,isLock:!1,eventCode:"KeyY",char:"н",charShift:"Н",charCaps:"Н"},key_u:{isFn:!1,isLock:!1,eventCode:"KeyU",char:"г",charShift:"Г",charCaps:"Г"},key_i:{isFn:!1,isLock:!1,eventCode:"KeyI",char:"ш",charShift:"Ш",charCaps:"Ш"},key_o:{isFn:!1,isLock:!1,eventCode:"KeyO",char:"щ",charShift:"Щ",charCaps:"Щ"},key_p:{isFn:!1,isLock:!1,eventCode:"KeyP",char:"з",charShift:"З",charCaps:"З"},key_bracket_left:{isFn:!1,isLock:!1,eventCode:"BracketLeft",char:"х",charShift:"Х",charCaps:"Х"},key_bracket_right:{isFn:!1,isLock:!1,eventCode:"BracketLeft",char:"ъ",charShift:"Ъ",charCaps:"Ъ"},key_delete:{isFn:!0,isLock:!1,eventCode:"Delete",eventType:"removeNext",char:"DEL"},key_capslock:{isFn:!0,isLock:!0,eventCode:"CapsLock",eventType:"toggleCaps",char:"CapsLock"},key_a:{isFn:!1,isLock:!1,eventCode:"KeyA",char:"ф",charShift:"Ф",charCaps:"Ф"},key_s:{isFn:!1,isLock:!1,eventCode:"KeyS",char:"ы",charShift:"Ы",charCaps:"Ы"},key_d:{isFn:!1,isLock:!1,eventCode:"KeyD",char:"в",charShift:"В",charCaps:"В"},key_f:{isFn:!1,isLock:!1,eventCode:"KeyF",char:"а",charShift:"А",charCaps:"А"},key_g:{isFn:!1,isLock:!1,eventCode:"KeyG",char:"п",charShift:"П",charCaps:"П"},key_h:{isFn:!1,isLock:!1,eventCode:"KeyH",char:"р",charShift:"Р",charCaps:"Р"},key_j:{isFn:!1,isLock:!1,eventCode:"KeyJ",char:"о",charShift:"О",charCaps:"О"},key_k:{isFn:!1,isLock:!1,eventCode:"KeyK",char:"л",charShift:"Л",charCaps:"Л"},key_l:{isFn:!1,isLock:!1,eventCode:"KeyL",char:"д",charShift:"Д",charCaps:"Д"},key_doubledot:{isFn:!1,isLock:!1,eventCode:"Semicolon",char:"ж",charShift:"Ж",charCaps:"Ж"},key_quote:{isFn:!1,isLock:!1,eventCode:"Quote",char:"э",charShift:"Э",charCaps:"Э"},key_enter:{isFn:!0,isLock:!1,eventCode:"Enter",eventType:"newLine",char:"Enter"},key_shift_left:{isFn:!0,isLock:!0,eventCode:"ShiftLeft",eventType:"toggleShift",char:"L. Shift",pairKey:"key_shift_right"},key_backslash:{isFn:!1,isLock:!1,eventCode:"Backslash",char:"\\",charShift:"/",charCaps:"\\"},key_z:{isFn:!1,isLock:!1,eventCode:"KeyZ",char:"я",charShift:"Я",charCaps:"Я"},key_x:{isFn:!1,isLock:!1,eventCode:"KeyX",char:"ч",charShift:"Ч",charCaps:"Ч"},key_c:{isFn:!1,isLock:!1,eventCode:"KeyC",char:"с",charShift:"С",charCaps:"С"},key_v:{isFn:!1,isLock:!1,eventCode:"KeyV",char:"м",charShift:"М",charCaps:"М"},key_b:{isFn:!1,isLock:!1,eventCode:"KeyB",char:"и",charShift:"И",charCaps:"И"},key_n:{isFn:!1,isLock:!1,eventCode:"KeyN",char:"т",charShift:"Т",charCaps:"Т"},key_m:{isFn:!1,isLock:!1,eventCode:"KeyM",char:"ь",charShift:"Ь",charCaps:"Ь"},key_comma:{isFn:!1,isLock:!1,eventCode:"Comma",char:"б",charShift:"Б",charCaps:"Б"},key_dot:{isFn:!1,isLock:!1,eventCode:"Period",char:"ю",charShift:"Ю",charCaps:"Ю"},key_slash:{isFn:!1,isLock:!1,eventCode:"Slash",char:".",charShift:",",charCaps:"."},key_up:{isFn:!0,isLock:!1,eventCode:"ArrowUp",eventType:"moveUp",char:"▲"},key_shift_right:{isFn:!0,isLock:!0,eventCode:"ShiftRight",eventType:"toggleShift",char:"R. Shift",pairKey:"key_shift_left"},key_ctrl_left:{isFn:!0,isLock:!0,eventCode:"ControlLeft",eventType:"toggleControl",char:"Ctrl",pairKey:"key_ctrl_right"},key_win_left:{isFn:!0,isLock:!1,eventCode:"MetaLeft ",eventType:"toggleWin",char:"WIN",pairKey:"key_win_right"},key_alt_left:{isFn:!0,isLock:!0,eventCode:"AltLeft",eventType:"toggleAlt",char:"Alt",pairKey:"key_alt_right"},key_space:{isFn:!1,isLock:!1,eventCode:"Space",char:" ",charShift:" ",charCaps:" "},key_alt_right:{isFn:!0,isLock:!0,eventCode:"AltRight",eventType:"toggleAlt",char:"Alt",pairKey:"key_alt_left"},key_win_right:{isFn:!0,isLock:!1,eventCode:"MetaRight ",eventType:"toggleWin",char:"WIN",pairKey:"key_win_left"},key_left:{isFn:!0,isLock:!1,eventCode:"ArrowLeft",eventType:"movePrev",char:"◄"},key_down:{isFn:!0,isLock:!1,eventCode:"ArrowDown",eventType:"moveDown",char:"▼"},key_right:{isFn:!0,isLock:!1,eventCode:"ArrowRight",eventType:"moveNext",char:"►"},key_ctrl_right:{isFn:!0,isLock:!0,eventCode:"ControlRight",eventType:"toggleControl",char:"Ctrl",pairKey:"key_ctrl_left"}};function n(e,t){let a=!1;return e.getAttribute("class").indexOf(t)>-1&&(a=!0),a}function c(e,t=250){let a=!1;return n(e,"active")&&(a=!0,setTimeout(()=>{e.classList.remove("active")},t)),a}function o(e){let t=!1;return n(e,"active")||(e.classList.add("active"),t=!0),t}var h=class{constructor(e,t){this.actualLanguage=t||"EN",this.keyboards={EN:{layout:s,mapping:i},RU:{layout:s,mapping:r}},this.eventHistory=[],this.fnHistory=[],this.strings=[],this.parentElement=e,this.shiftState=!1,this.capsState=!1,this.altState=!1,this.controlState=!1,this.cursorPosition=0,this.readFromStorage(),this.renderInput(),this.renderKeyboard(),this.textarea.focus()}saveToStorage(){const e=JSON.stringify({actualLanguage:this.actualLanguage,strings:this.strings.slice(),inputValue:this.textarea.value.slice(),cursorPosition:this.textarea.selectionStart,states:{capsState:this.capsState}});localStorage["rs-virtkey"]=e}readFromStorage(){let e=!1;if(localStorage["rs-virtkey"]){e=!0;const t=JSON.parse(localStorage["rs-virtkey"]);this.actualLanguage=t.actualLanguage,this.strings=t.strings.slice(),this.capsState=t.states.capsState,this.cursorPosition=t.cursorPosition}return e}clearRendered(){const e=this.parentElement.querySelector(".virtual-keyboard__input-wrapper"),t=this.parentElement.querySelector(".virtual-keyboard__layout-wrapper");e&&e.remove(),t&&t.remove(),this.keyboardInput=null,this.keyboardKeys=null}clearRenderedLayout(){const e=this.parentElement.querySelector(".virtual-keyboard__layout-wrapper");e&&e.remove(),this.keyboardKeys=null}clearRenderedInput(){const e=this.parentElement.querySelector(".virtual-keyboard__input-wrapper");e&&e.remove(),this.keyboardInput=null}renderInput(){this.clearRenderedInput(),this.keyboardInput=document.createElement("div"),this.keyboardInput.classList.add("virtual-keyboard__input-wrapper"),this.textarea=document.createElement("textarea"),this.textarea.classList.add("virtual-keyboard__input"),this.textarea.value=this.strings.join("\n"),this.textarea.setAttribute("rows","25"),this.textarea.setAttribute("cols","80"),this.keyboardInput.insertAdjacentElement("beforeEnd",this.textarea);const e=this;this.keyboardInput.addEventListener("keydown",t=>{this.inputListener.call(e,t)}),this.keyboardInput.addEventListener("keyup",t=>{this.inputListener.call(e,t)}),this.keyboardInput.addEventListener("keypress",null),this.parentElement.insertAdjacentElement("beforeEnd",this.keyboardInput)}renderKeyboard(){this.clearRenderedLayout(),this.keyboardKeys=document.createElement("div"),this.keyboardKeys.classList.add("virtual-keyboard__layout-wrapper"),this.shiftState&&this.keyboardKeys.classList.add("shift-on"),this.capsState&&this.keyboardKeys.classList.add("caps-on"),this.controlState&&this.keyboardKeys.classList.add("control-on"),this.altState&&this.keyboardKeys.classList.add("alt-on");const e=this.keyboards[this.actualLanguage],t=[];e.layout.forEach(a=>{const s=document.createElement("div");s.classList.add("virtual-keyboard__layout-row"),s.classList.add("keyboard-row");const i=[];a.forEach(t=>{const a=e.mapping[t],r=document.createElement("div");r.classList.add("keyboard-key"),r.classList.add(t),r.setAttribute("data-event-code",a.eventCode),r.setAttribute("data-keyname",t);const n=document.createElement("span");n.classList.add("caption-span"),n.classList.add("caption-normal");const c=document.createElement("span");c.classList.add("caption-span"),c.classList.add("caption-shift");const o=document.createElement("span");o.classList.add("caption-span"),o.classList.add("caption-caps"),a.isFn?(r.classList.add("functional"),a.isLock&&r.classList.add("fn-locker"),r.setAttribute("data-command",a.eventType),n.innerHTML=a.char,c.innerHTML=a.char,o.innerHTML=a.char):(n.innerHTML=a.char,c.innerHTML=a.charShift,o.innerHTML=a.charCaps),"Space"===a.eventCode&&(n.innerHTML="Space",c.innerHTML="Space",o.innerHTML="Space"),"CapsLock"===a.eventCode&&this.capsState&&r.classList.add("active"),r.insertAdjacentElement("beforeEnd",n),r.insertAdjacentElement("beforeEnd",c),r.insertAdjacentElement("beforeEnd",o),i.push(r),s.insertAdjacentElement("beforeEnd",r)}),t.push(s)}),t.forEach(e=>{this.keyboardKeys.insertAdjacentElement("beforeEnd",e)});const a=this;this.keyboardKeys.addEventListener("click",e=>{this.layoutListener.call(a,e)}),this.parentElement.insertAdjacentElement("beforeEnd",this.keyboardKeys)}renderAll(){this.renderInput(),this.renderKeyboard()}findKeyCodeElement(e){let t=null;return this.keyboardKeys.querySelectorAll(".keyboard-key").forEach(a=>{a.getAttribute("data-event-code").indexOf(e)>-1&&(t=a)}),t}findKeyNameElement(e){let t=null;return this.keyboardKeys.querySelectorAll(".keyboard-key").forEach(a=>{a.getAttribute("data-keyname").indexOf(e)>-1&&(t=a)}),t}toggleLanguage(e){null==e?"RU"===this.actualLanguage?this.actualLanguage="EN":this.actualLanguage="RU":this.actualLanguage=e,this.shiftState=!1,this.altState=!1,this.controlState=!1,this.renderKeyboard()}toggleShift(e){this.shiftState=null==e?!this.shiftState:e,this.shiftState?this.keyboardKeys.classList.add("shift-on"):this.keyboardKeys.classList.remove("shift-on")}toggleCaps(e){this.capsState=null==e?!this.capsState:e,this.capsState?this.keyboardKeys.classList.add("caps-on"):this.keyboardKeys.classList.remove("caps-on"),this.renderKeyboard()}toggleAlt(e){this.altState=null==e?!this.altState:e,this.altState?this.keyboardKeys.classList.add("alt-on"):this.keyboardKeys.classList.remove("alt-on")}toggleControl(e){this.controlState=null==e?!this.controlState:e,this.controlState?this.keyboardKeys.classList.add("control-on"):this.keyboardKeys.classList.remove("control-on")}textareaInsert(e){let t=this.textarea.value;const a=this.textarea.selectionStart,s=this.textarea.selectionEnd;t=t.slice(0,a)+e+t.slice(s),this.textarea.value=t;const i=a+e.length;this.textarea.selectionStart=i,this.textarea.selectionEnd=i,this.cursorPosition=this.textarea.selectionStart,this.strings=t}textareaRemovePrev(){let e=this.textarea.value;const t=e.length,a=this.textarea.selectionStart;e&&t&&a>0&&(e=e.slice(0,a-1)+e.slice(a,t),this.textarea.value=e,this.textarea.selectionStart=a-1,this.textarea.selectionEnd=a-1,this.cursorPosition=this.textarea.selectionStart)}textareaRemoveNext(){let e=this.textarea.value;const t=e.length,a=this.textarea.selectionStart;e&&t&&a>0&&a<t-1&&(e=e.slice(0,a)+e.slice(a+1,t-1),this.textarea.value=e,this.textarea.selectionStart=a,this.textarea.selectionEnd=a,this.cursorPosition=this.textarea.selectionStart)}textareaMoveNext(){this.textarea.value&&this.textarea.selectionStart<this.textarea.value.length-1&&(this.textarea.selectionStart+=1,this.textarea.selectionEnd=this.textarea.selectionStart)}textareaMovePrev(){this.textarea.selectionStart>0&&this.textarea.value&&(this.textarea.selectionStart-=1,this.textarea.selectionEnd=this.textarea.selectionStart)}textareaMoveUp(){this.currentPosition=this.textarea.selectionStart,this.strings=this.textarea.value.split("\n");let e=this.textarea.value.slice(0,this.currentPosition),t=[];if((t=e.split("\n")).length>1){const a=t[t.length-1].length,s=t[t.length-2].length;let i=0;i=a>=s?s:a,t.pop();let r=t[t.length-1];r=r.slice(0,i),t[t.length-1]=r,e=t.join("\n"),this.currentPosition=e.length,this.textarea.selectionStart=this.currentPosition,this.textarea.selectionEnd=this.currentPosition}else this.textarea.selectionStart=0,this.textarea.selectionEnd=0}textareaMoveDown(){this.currentPosition=this.textarea.selectionStart,this.strings=this.textarea.value.split("\n");let e=this.textarea.value.slice(0,this.currentPosition),t=[];if((t=e.split("\n")).length<this.strings.length){const a=t.length,s=t[t.length-1].length,i=this.strings[t.length].length;let r=0;r=s>=i?i:s,t.pop(),t.push(this.strings[a-1]),t.push(this.strings[a]);let n=t[t.length-1];n=n.slice(0,r),t[t.length-1]=n,e=t.join("\n"),this.currentPosition=e.length,this.textarea.selectionStart=this.currentPosition,this.textarea.selectionEnd=this.currentPosition}else this.textarea.selectionStart=0,this.textarea.selectionEnd=0}inputListener(e){const t="keydown"===e.type,a="keyup"===e.type,s=t||a,i=this.findKeyCodeElement.call(this,e.code);if(this.eventHistory.push({type:"physicalKey",fullEvent:e,virtKey:i,initStates:{shiftState:this.shiftState,capsState:this.capsState,altState:this.altState,controlState:this.controlState},textareaState:{selStart:this.textarea.selectionStart,selEnd:this.textarea.selectionEnd,text:this.textarea.value},strings:this.strings}),s&&i){const s=i.getAttribute("data-keyname"),r=this.keyboards[this.actualLanguage].mapping[s];if(t){if(r.isFn){switch(r.eventType){case"toggleShift":this.shiftState||this.toggleShift(!0),o(i),(this.shiftState&&this.altState||this.shiftState&&this.controlState)&&this.toggleLanguage();break;case"toggleAlt":this.altState||this.toggleAlt(!0),o(i),(this.shiftState&&this.altState||this.shiftState&&this.controlState)&&this.toggleLanguage();break;case"toggleControl":this.controlState||this.toggleControl(!0),o(i),(this.shiftState&&this.altState||this.shiftState&&this.controlState)&&this.toggleLanguage();break;case"toggleCaps":this.toggleCaps(null),this.capsState?o(i):c(i);break;case"insertTab":this.textareaInsert.call(this,"    "),o(i),this.textarea.focus(),c(i);break;case"moveUp":case"movePrev":case"moveDown":case"moveNext":case"removeNext":case"removePrev":o(i)}this.fnHistory.push({type:"physicalKey",eventType:e.type,virtKey:i,keyObj:r})}else o(i);this.textarea.focus()}if(a)if(r.isFn){switch(r.eventType){case"toggleShift":this.shiftState&&this.toggleShift(!1),c(i);break;case"toggleControl":this.controlState&&this.toggleControl(!1),c(i);break;case"toggleAlt":this.altState&&this.toggleAlt(!1),c(i);break;case"removePrev":c(i);break;case"Tab":this.textareaInsert("    "),c(i);break;case"newLine":case"moveUp":case"movePrev":case"moveDown":case"moveNext":case"removeNext":c(i)}this.fnHistory.push({type:"physicalKey",eventType:e.type,virtKey:i,keyObj:r})}else{if(this.capsState){const e=this.textarea.selectionStart-1;let t=this.textarea.value;const a=t.length,s=t[e].toLocaleUpperCase();t=t.slice(0,e)+s+t.slice(e+1,a-1),this.textarea.value=t}c(i)}this.strings=this.textarea.value.split("\n"),this.saveToStorage()}}layoutListener(e){e.preventDefault();let t=e.target,a=null,s=null;if(n(t,"caption-span")&&(t=t.closest(".keyboard-key")),n(t,"keyboard-key")){s=t;const i=t.getAttribute("data-keyname");if(a=this.keyboards[this.actualLanguage].mapping[i],this.eventHistory.push({type:"virtualKeyBefore",fullEvent:e,virtKey:s,initStates:{shiftState:this.shiftState,capsState:this.capsState,altState:this.altState,controlState:this.controlState},textareaState:{selStart:this.textarea.selectionStart,selEnd:this.textarea.selectionEnd,text:this.textarea.value},strings:this.strings}),a.isFn){switch(a.eventType){case"insertTab":s.classList.add("active"),this.textareaInsert("    "),c(s,450);break;case"removePrev":s.classList.add("active"),this.textareaRemovePrev(),c(s,450);break;case"removeNext":s.classList.add("active"),this.textareaRemoveNext(),c(s,450);break;case"newLine":s.classList.add("active"),this.textareaInsert("\n"),c(s,450);break;case"toggleCaps":this.toggleCaps(null),this.capsState?s.classList.add("active"):c(s,450);break;case"toggleShift":if(this.toggleShift(null),this.shiftState)s.classList.add("active");else{const e=this.actualLanguage,t=this.keyboards[e].mapping[a.pairKey],i=this.findKeyCodeElement(t.eventCode);setTimeout(()=>{n(s,"active")&&s.classList.remove("active"),n(i,"active")&&i.classList.remove("active")},250)}(this.shiftState&&this.altState||this.shiftState&&this.controlState)&&this.toggleLanguage();break;case"toggleControl":if(this.toggleControl(null),this.controlState)s.classList.add("active");else{const e=this.actualLanguage,t=this.keyboards[e].mapping[a.pairKey],i=this.findKeyCodeElement(t.eventCode);setTimeout(()=>{n(s,"active")&&s.classList.remove("active"),n(i,"active")&&i.classList.remove("active")},250)}this.shiftState&&this.controlState&&this.toggleLanguage();break;case"toggleAlt":if(this.toggleAlt(null),this.altState)s.classList.add("active");else{const e=this.actualLanguage,t=this.keyboards[e].mapping[a.pairKey],i=this.findKeyCodeElement(t.eventCode);setTimeout(()=>{n(s,"active")&&s.classList.remove("active"),n(i,"active")&&i.classList.remove("active")},250)}this.shiftState&&this.altState&&this.toggleLanguage();break;case"movePrev":case"moveNext":o(s),this.textareaMoveNext(),c(s,450);break;case"moveUp":o(s),this.textareaMoveUp(),c(s,450);break;case"moveDown":o(s),this.textareaMoveDown(),c(s,450);break;case"toggleWin":o(s),c(s,450)}}else{let e=a.char;this.shiftState&&(e=a.charShift),this.capsState&&(e=a.charCaps),this.shiftState&&this.capsState&&(e=a.char),this.textareaInsert(e),s.classList.add("active"),setTimeout(()=>{s.classList.remove("active")},450)}this.strings=this.textarea.value.split("\n"),this.eventHistory.push({type:"virtualKeyAfter",fullEvent:e,virtKey:s,initStates:{shiftState:this.shiftState,capsState:this.capsState,altState:this.altState,controlState:this.controlState},textareaState:{selStart:this.textarea.selectionStart,selEnd:this.textarea.selectionEnd,text:this.textarea.value},strings:this.strings})}this.saveToStorage()}};const l=document.querySelector("body"),y=document.createElement("div");y.classList.add("virtkeyb-page__wrapper"),y.classList.add("keyboard-wrapper");const k=new h(y);window.mainKeyboard=k,l.insertAdjacentElement("afterBegin",y)}]);
//# sourceMappingURL=bundle.js.map